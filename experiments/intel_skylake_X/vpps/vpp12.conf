#!/bin/bash

sudo /usr/bin/vpp -c startup12.conf
sleep 2

sudo vppctl -s /run/vpp/cli-vpp12.sock create memif socket id 13 filename /run/vpp/memif13.sock
sudo vppctl -s /run/vpp/cli-vpp12.sock create memif socket id 14 filename /run/vpp/memif14.sock

sudo vppctl -s /run/vpp/cli-vpp12.sock create interface memif id 0 socket-id 13 slave
sudo vppctl -s /run/vpp/cli-vpp12.sock set interface ip address memif13/0 10.10.15.2/24
sudo vppctl -s /run/vpp/cli-vpp12.sock set interface state memif13/0 up

sudo vppctl -s /run/vpp/cli-vpp12.sock create interface memif id 0 socket-id 14 master
sudo vppctl -s /run/vpp/cli-vpp12.sock set interface ip address memif14/0 10.10.16.1/24
sudo vppctl -s /run/vpp/cli-vpp12.sock set interface state memif14/0 up

#sudo vppctl -s /run/vpp/cli-vpp12.sock ip route add 10.10.2.0/24 via 10.10.16.2
#sudo vppctl -s /run/vpp/cli-vpp12.sock ip route add 10.10.1.0/24 via 10.10.15.1

sudo vppctl -s /run/vpp/cli-vpp12.sock ip route add 48.0.0.0/8 via 10.10.16.2

sudo vppctl -s /run/vpp/cli-vpp12.sock clear runtime
